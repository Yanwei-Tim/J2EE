<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="DispatchRouteChart">
	<typeAlias alias="chart" type="com.neusoft.clw.yunxing.routechart.chart.domain.RouteChart" />
		
	<resultMap class="chart" id="route_info">
		<result property="route_id" column="ROUTE_ID" />
		<result property="route_name" column="ROUTE_NAME" />
		<result property="route_incharge_person" column="ROUTE_INCHARGE_PERSON" />
	</resultMap>
	<resultMap class="chart" id="route_exe_info">
		<result property="exe_date" column="exe_date" />
		<result property="VIN" column="vehicle_vin" />
		<result property="vehicle_ln" column="vehicle_ln" />
		<result property="vehicle_code" column="vehicle_code" />
		<result property="vehicle_type" column="vehicle_type" />
		<result property="route_class" column="route_class" />
		<result property="route_name" column="route_name" />
		<result property="send_condition" column="send_condition" />
		<result property="send_order" column="send_order" />
		<result property="operate_time" column="operate_time" />
		<result property="update_time" column="update_time" />
		<result property="site_updown" column="site_updown" />
		<result property="mesg_flag" column="mesg_flag" />
	</resultMap>
	<resultMap class="chart" id="route_info_to_car">
		<result property="route_id" column="ROUTE_ID" />
		<result property="route_name" column="ROUTE_NAME" />
		<result property="route_class" column="ROUTE_CLASS" />
	</resultMap>
	<resultMap class="chart" id="chart_info">
		<result property="route_id" column="ROUTE_ID" />
		<result property="route_name" column="ROUTE_NAME" />
		<result property="site_id" column="SITE_ID" />
		<result property="site_name" column="SITE_NAME" />
		<result property="site_updown" column="SITE_UPDOWN" />
		<result property="rs_order" column="RS_ORDER" />
		<result property="re_flag" column="RE_FLAG" />
		<result property="VIN" column="VEHICLE_VIN" />
		<result property="vehicle_ln" column="VEHICLE_LN" />
		<result property="inout_flag" column="INOUT_FLAG" />
		<result property="car_state" column="CAR_STATE" />
		<result property="upNum" column="UPNUM" />
		<result property="downNum" column="DOWNNUM" />
		<result property="stu_error" column="STU_ERROR" />
		<result property="time_error" column="TIME_ERROR" />
	</resultMap>
	<resultMap class="chart" id="chart_car_info">
		<result property="route_id" column="ROUTE_ID" />
		<result property="status" column="status" />
		<result property="trip_id" column="trip_id" />
		<result property="type" column="type" />
		<result property="update_time" column="update_time" />
		<result property="VIN" column="VEHICLE_VIN" />
		<result property="vehicle_ln" column="VEHICLE_LN" />
		<result property="vehicle_code" column="VEHICLE_CODE" />
		<result property="send_condition" column="send_condition" />
		<result property="send_time" column="send_time" />
		<result property="send_order" column="send_order" />
		<result property="week_seq" column="week_seq" />
		<result property="add_flag" column="add_flag" />
		<result property="valid_days" column="valid_days" />
		<result property="car_state" column="CAR_STATE" />
		<result property="end_time" column="end_time" />
		<result property="start_time" column="start_time" />
		<result property="limite_number" column="limite_number" />
		<result property="mesg_flag" column="mesg_flag" />
		<result property="vehicle_type" column="vehicle_type" />
		
		<result property="driver_name" column="driver_name" />
		<result property="driver_id" column="driver_id" />
		<result property="valid_flag" column="valid_flag" />
		<result property="crc" column="crc" />
		<result property="trip_group" column="trip_group" />
		<result property="exe_date" column="exe_date" />
		<result property="updriver_id" column="updriver_id" />
	</resultMap>
	<resultMap class="chart" id="chart_car_info2">
		<result property="route_id" column="ROUTE_ID" />
		<result property="trip_id" column="trip_id" />
		<result property="type" column="type" />
		<result property="update_time" column="update_time" />
		<result property="VIN" column="VEHICLE_VIN" />
		<result property="vehicle_ln" column="VEHICLE_LN" />
		<result property="send_condition" column="send_condition" />
		<result property="send_time" column="send_time" />
		<result property="send_order" column="send_order" />
		<result property="week_seq" column="week_seq" />
		<result property="limite_number" column="limite_number" />
		<result property="mesg_flag" column="mesg_flag" />
	</resultMap>
	<resultMap class="chart" id="stu">
		<result property="stu_name" column="STU_NAME" />
		<result property="stu_code" column="STU_CODE" />
		<result property="stu_school" column="STU_SCHOOL" />
		<result property="stu_class" column="STU_CLASS" />
		<result property="VSS_FLAG" column="VSS_FLAG" />
		<result property="stu_relative_tel" column="RELATIVE_TEL" />
		<result property="stu_teacher_tel" column="TEACHER_TEL" />
	</resultMap>
	
	<resultMap class="chart" id="car_select">
		<result property="vehicle_ln" column="VEHICLE_LN" />
		<result property="VIN" column="VEHICLE_VIN" />
	</resultMap>
	<resultMap class="chart" id="delvehicleinExemap">
		<result property="trip_id" column="trip_id" />
		<result property="VIN" column="VEHICLE_VIN" />
		<result property="update_time" column="update_time" />
		<result property="exe_date" column="exe_date" />
	</resultMap>
	<parameterMap id="pm_add_route_car_" class="Map">
		<parameter property="route_id" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="vehicle_vin" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="exe_date" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="send_order" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="send_condition" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="send_time" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="update_by" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="week_seq" javaType="Integer" jdbcType="VARCHAR" mode="IN" />
		<parameter property="start_time" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="end_time" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="add_flag" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="driver_id" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="out_flag" javaType="String" jdbcType="VARCHAR" mode="OUT" />
	</parameterMap>
	<parameterMap id="pm_updateold_route_car_" class="Map">
		<parameter property="p_date" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="send_condition" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="route_id" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="vin_code" javaType="String" jdbcType="VARCHAR" mode="IN" />
	</parameterMap>
	<parameterMap id="pm_add_route_line_" class="Map">
		<parameter property="route_id" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="vehicle_vin" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="exe_date" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="send_condition" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="send_time" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="update_by" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="week_seq" javaType="Integer" jdbcType="VARCHAR" mode="IN" />
		<parameter property="start_time" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="end_time" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="add_flag" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="driver_id" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="out_flag" javaType="String" jdbcType="VARCHAR" mode="OUT" />
	</parameterMap>
	<parameterMap id="pm_del_route_car_" class="Map">
		<parameter property="route_id" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="trip_id" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="vehicle_vin" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="send_order" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="week_seq" javaType="Integer" jdbcType="VARCHAR" mode="IN" />
		<parameter property="exe_date" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="out_flag" javaType="String" jdbcType="VARCHAR" mode="OUT" />
	</parameterMap>
	<parameterMap id="pm_del_route_bygroup_" class="Map">
		<parameter property="route_id" javaType="String" jdbcType="NUMBER" mode="IN" />
		<parameter property="vehicle_vin" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="send_order" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="add_flag" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="exe_date" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="trip_group" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="out_flag" javaType="String" jdbcType="VARCHAR" mode="OUT" />
	</parameterMap>
	<parameterMap id="pm_make_route_car_t" class="Map">
		<parameter property="exe_date" javaType="String" jdbcType="VARCHAR" mode="IN" />
	</parameterMap>
	<parameterMap id="pm_tqc_trip_exe_back_" class="Map">
		<parameter property="route_id" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="exe_date" javaType="String" jdbcType="VARCHAR" mode="IN" />
	</parameterMap>
	<parameterMap id="pm_tqc_trip_exe_totemp_" class="Map">
		<parameter property="route_id" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="exe_date" javaType="String" jdbcType="VARCHAR" mode="IN" />
	</parameterMap>
	<select id="getRouteCount" parameterClass="chart" resultClass="Integer">
		SELECT COUNT(1) FROM CLW_XC_ROUTE_T   
		WHERE VALID_FLAG = '0'
		 <isNotEmpty prepend="AND" property="route_name">
               ROUTE_NAME LIKE '%' || #route_name# ||'%' ESCAPE '\'
         </isNotEmpty>         
         <isNotEmpty prepend="AND" property="route_organization_id">
			   ROUTE_ORGANIZATION_ID IN
			   <![CDATA[
					    	(SELECT ENTERPRISE_ID
								     FROM CLW_JC_ENTERPRISE_VI
								     WHERE LEFT_NUM >= (SELECT LEFT_NUM
								                  FROM CLW_JC_ENTERPRISE_VI
								                  WHERE ENTERPRISE_ID = #route_organization_id#)
								     AND RIGHT_NUM <=(SELECT RIGHT_NUM
								                  FROM CLW_JC_ENTERPRISE_VI
								                  WHERE ENTERPRISE_ID = #route_organization_id#)        
								)
				]]>
         </isNotEmpty>
	</select>
	
	<select id="getRouteInfos" parameterClass="chart" resultMap="route_info">
		SELECT ROUTE_ID,ROUTE_NAME, ROUTE_INCHARGE_PERSON FROM CLW_XC_ROUTE_T   
		WHERE VALID_FLAG = '0'
		 <isNotEmpty prepend="AND" property="route_name">
               ROUTE_NAME LIKE '%' || #route_name# ||'%' ESCAPE '\'
         </isNotEmpty>
		 <isNotEmpty prepend="AND" property="route_id">
               ROUTE_ID = #route_id#
         </isNotEmpty>                   
         <isNotEmpty prepend="AND" property="route_organization_id">
			   ROUTE_ORGANIZATION_ID IN
			   <![CDATA[
					    	(SELECT ENTERPRISE_ID
								     FROM CLW_JC_ENTERPRISE_VI
								     WHERE LEFT_NUM >= (SELECT LEFT_NUM
								                  FROM CLW_JC_ENTERPRISE_VI
								                  WHERE ENTERPRISE_ID = #route_organization_id#)
								     AND RIGHT_NUM <=(SELECT RIGHT_NUM
								                  FROM CLW_JC_ENTERPRISE_VI
								                  WHERE ENTERPRISE_ID = #route_organization_id#)        
								)
				]]>
         </isNotEmpty>
         <dynamic prepend="ORDER BY">  
		   <isNotEmpty property="sortname">  
		    $sortname$   $sortorder$  
		   </isNotEmpty>  
		 </dynamic>
	</select>
	<select id="getexe_comondInfoscount" parameterClass="map" resultClass="Integer">
		select count(1)
		 from CLW_CL_BASE_INFO_T t,CLW_XC_ROUTE_T route,TQC_TRIP_EXECUTE exe
		where t.vehicle_vin = exe.vehicle_vin
<!-- 		and t.vehicle_type = '0' -->
		and t.organization_id in
       (select enterprise_id
          from clw_jc_enterprise_vi
         where left_num &gt;=
               (select left_num
                  from clw_jc_enterprise_vi
                 where enterprise_id = #organizationID#)
           and right_num &lt;=
               (select right_num
                  from clw_jc_enterprise_vi
                 where enterprise_id = #organizationID#))
		and t.valid_flag = '0'
		and exe.route_id = route.route_id
		 <isNotEmpty prepend="AND" property="endTime">
               exe.exe_date &lt;= to_date(#endTime#,'yyyy-mm-dd HH24:MI:SS')
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="begTime">
               exe.exe_date &gt;= to_date(#begTime#,'yyyy-mm-dd HH24:MI:SS')
         </isNotEmpty>
		 <isNotEmpty prepend="AND" property="vehicle_vin">
               t.VEHICLE_vin like '%' || #vehicle_vin# ||'%' escape '\'
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="vehicle_code">
               t.VEHICLE_CODE like '%' || #vehicle_code# ||'%' escape '\'
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_id">
              route.route_id = #route_id#
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_class">
              route.route_class in ($route_class$)
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_class_r">
              route.route_class in $route_class_r$
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_res">
              SIGN(exe.update_time-exe.operate_time) = #route_res#
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_res_null">
              (SIGN(exe.update_time-exe.operate_time) = #route_res_null#
              or SIGN(exe.update_time-exe.operate_time) is null )
              and ceil((sysdate - exe.operate_time) * 24 * 60) &gt; 5
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_res_ing">
              (SIGN(exe.update_time - exe.operate_time) = #route_res_ing# or
                        exe.update_time  is null)
                  and
                       ceil((sysdate - exe.operate_time) * 24 * 60) &lt; 5 and
                       ceil((sysdate - exe.operate_time) * 24 * 60) &gt; 0
         </isNotEmpty>        
	</select>
	<select id="getexe_comondInfos" parameterClass="map" resultMap="route_exe_info">
		select to_char(exe.exe_date,'yyyy-mm-dd') exe_date,exe.vehicle_vin,nvl(t.vehicle_code,'未知') vehicle_code,t.vehicle_type,t.vehicle_ln,route.route_class,
		route.route_name,exe.send_condition,exe.send_order,to_char(exe.operate_time,'yyyy-mm-dd HH24:MI:SS') operate_time,to_char(exe.update_time,'yyyy-mm-dd HH24:MI:SS') update_time,
		(select count(1) from CLW_XC_ROUTESITE_T t where t.route_id = route.route_id) site_updown,
		case when exe.update_time is not null and SIGN(exe.update_time - exe.operate_time)=1
                         then 1
                         when 
                           ceil((sysdate - exe.operate_time) * 24 * 60) &lt;5 and ceil((sysdate - exe.operate_time) * 24 * 60) >0
                           then 0
                           else -1
                       end mesg_flag
		 from CLW_CL_BASE_INFO_T t,CLW_XC_ROUTE_T route,TQC_TRIP_EXECUTE exe
		where t.vehicle_vin = exe.vehicle_vin
<!-- 		and t.vehicle_type = '0' -->
		and t.organization_id in
       (select enterprise_id
          from clw_jc_enterprise_vi
         where left_num &gt;=
               (select left_num
                  from clw_jc_enterprise_vi
                 where enterprise_id = #organizationID#)
           and right_num &lt;=
               (select right_num
                  from clw_jc_enterprise_vi
                 where enterprise_id = #organizationID#))
		and t.valid_flag = '0'
		and exe.route_id = route.route_id
		 <isNotEmpty prepend="AND" property="endTime">
               exe.exe_date &lt;= to_date(#endTime#,'yyyy-mm-dd HH24:MI:SS')
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="begTime">
               exe.exe_date &gt;= to_date(#begTime#,'yyyy-mm-dd HH24:MI:SS')
         </isNotEmpty>
		 <isNotEmpty prepend="AND" property="vehicle_vin">
               t.VEHICLE_vin like '%' || #vehicle_vin# ||'%' escape '\'
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="vehicle_code">
               t.VEHICLE_CODE like '%' || #vehicle_code# ||'%' escape '\'
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_id">
              route.route_id = #route_id#
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_class">
              route.route_class in ($route_class$)
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_res">
              SIGN(exe.update_time-exe.operate_time) = #route_res#
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_res_null">
              (SIGN(exe.update_time-exe.operate_time) = #route_res_null#
              or SIGN(exe.update_time-exe.operate_time) is null )
              and ceil((sysdate - exe.operate_time) * 24 * 60) &gt; 5
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="route_res_ing">
              (SIGN(exe.update_time - exe.operate_time) = #route_res_ing# or
                        exe.update_time  is null)
                  and
                       ceil((sysdate - exe.operate_time) * 24 * 60) &lt; 5 and
                       ceil((sysdate - exe.operate_time) * 24 * 60) &gt; 0
         </isNotEmpty>
         <dynamic prepend="ORDER BY">
		   <isNotEmpty property="sortname">  
		    $sortname$   $sortorder$  
		   </isNotEmpty>  
		 </dynamic>
	</select>
	<select id="getlineInfobyentForChart" parameterClass="map" resultClass="String">
        select t.id from (select s.*, rownum as rownum_2 from (
        SELECT TO_CHAR(ROUTE.ROUTE_ID) ID,
                     ROUTE.ROUTE_NAME NAME,
                     ROUTE.ROUTE_ORGANIZATION_ID PID,
                     'false' open,
                     'pLine' as iconSkin
                FROM CLW_XC_ROUTE_T ROUTE
               WHERE ROUTE_ORGANIZATION_ID in
                     (select enterprise_id
                        from clw_jc_enterprise_vi
                       where left_num &gt;=
                             (select left_num
                                from clw_jc_enterprise_vi
                               where enterprise_id =
                                     #enterpriseId#)
                         and right_num &lt;=
                             (select right_num
                                from clw_jc_enterprise_vi
                               where enterprise_id =#enterpriseId#))
                 AND ROUTE.VALID_FLAG = '0'
                 AND ROUTE.ROUTE_CLASS IS NOT NULL
                 AND ROUTE.ROUTE_CLASS = #route_class#
                 <isNotEmpty prepend="AND" property="route_id">
		               ROUTE.route_id in 
						<iterate property="route_id" conjunction=","  open="(" close=")">
				       		#route_id[]#
				     	</iterate>
		         </isNotEmpty>
               ORDER BY NLSSORT(pid, 'NLS_SORT=SCHINESE_PINYIN_M') DESC
               ) s where rownum&lt;= #rowEnd# ) t where rownum_2 &gt; #rowStart#
	</select>
	<!-- <select id="getroutecarinfobytime" parameterClass="map" resultMap="chart_car_info2">
        select trip_id, t.route_id,type,update_time,info.VEHICLE_LN, t.vehicle_vin, send_condition, send_time, send_order, week_seq,info.limite_number,
        decode(t.update_time,null,'',1) mesg_flag
        from CLW_XC_TRIP_T t ,CLW_CL_BASE_INFO_T info 
		where t.vehicle_vin = info.vehicle_vin
        and t.route_id = #route_id#
        and t.week_seq = #week_seq#
	</select> -->
	<delete id="delroutecar_dis" parameterClass="map">
		delete TQC_TRIP_EXECUTE t where  t.route_id = #route_id#
        and t.exe_date = to_date(#exe_date#,'yyyy-mm-dd')
	</delete>
	<!-- <select id="getdispatchroutecar" parameterClass="map" resultMap="chart_car_info">
        select t.trip_id,t.route_id,t.type,t.update_time, info.vehicle_ln ,t.vehicle_vin,info.vehicle_code,
    	t.send_condition,t.send_time,t.send_order,week_seq,add_flag,'' car_state,t.valid_days,to_char(t.end_time,'yyyy-mm-dd') end_time,to_char(t.start_time,'yyyy-mm-dd') start_time,
    	info.limite_number,decode(t.update_time,null,'',1) mesg_flag
        from TQC_TRIP_EXECUTE t ,CLW_CL_BASE_INFO_T info 
		where t.vehicle_vin = info.vehicle_vin
        and t.route_id = #route_id#
        and t.add_flag = '1'
        and t.exe_date = to_date(#exe_date#,'yyyy-mm-dd')
	</select> -->
	<select id="getlineInfobyentForChartCount" parameterClass="map" resultClass="Integer">
        select count(1) from (
        SELECT TO_CHAR(ROUTE.ROUTE_ID) ID,
                     ROUTE.ROUTE_NAME NAME,
                     ROUTE.ROUTE_ORGANIZATION_ID PID,
                     'false' open,
                     'pLine' as iconSkin
                FROM CLW_XC_ROUTE_T ROUTE
               WHERE ROUTE_ORGANIZATION_ID in
                     (select enterprise_id
                        from clw_jc_enterprise_vi
                       where left_num &gt;=
                             (select left_num
                                from clw_jc_enterprise_vi
                               where enterprise_id =
                                     #enterpriseId#)
                         and right_num &lt;=
                             (select right_num
                                from clw_jc_enterprise_vi
                               where enterprise_id =#enterpriseId#))
                 AND ROUTE.VALID_FLAG = '0'
                 AND ROUTE.ROUTE_CLASS IS NOT NULL
                 AND ROUTE.ROUTE_CLASS = #route_class#
                 <isNotEmpty prepend="AND" property="route_id">
		               ROUTE.route_id in 
						<iterate property="route_id" conjunction=","  open="(" close=")">
				       		#route_id[]#
				     	</iterate>
		         </isNotEmpty>
               ORDER BY NLSSORT(name, 'NLS_SORT=SCHINESE_PINYIN_M') DESC
               )
	</select>
	<select id="getlineInfobyvinForChart" parameterClass="map" resultMap="route_info_to_car">
        select  t.ROUTE_ID,t.route_name,t.route_class from (select s.*, rownum as rownum_2 from (
          SELECT distinct TO_CHAR(ROUTE.ROUTE_ID) ROUTE_ID,ROUTE.route_name,route.route_class
          FROM CLW_XC_ROUTE_T ROUTE,TQC_TRIP_EXECUTE exe
         WHERE exe.vehicle_vin = #vin# AND
            route.route_id = exe.route_id and
            exe.exe_date = to_date(#exe_date#,'yyyy-mm-dd') and
            ROUTE.route_class is not null and
            ROUTE.VALID_FLAG = '0'
            order by ROUTE.ROUTE_ID
         ) s where rownum &lt;= #rowEnd# ) t where rownum_2 &gt; #rowStart#
	</select>
	<!-- 添加新线路查询新线路页数 -->
	<select id="getlineInfobyvinForChart_pagec" parameterClass="map" resultClass="Integer">
	select rown
	  from (select t.rown rown,t.route_id, rownum rowlength from (select route_id,rownum rown
	          from (SELECT distinct TO_CHAR(ROUTE.ROUTE_ID) ROUTE_ID,
	                                ROUTE.route_name,
	                                route.route_class
	                  FROM CLW_XC_ROUTE_T ROUTE, TQC_TRIP_EXECUTE exe
	                 WHERE exe.vehicle_vin = #vehicle_vin#
	                   AND route.route_id = exe.route_id
	                   and exe.exe_date = to_date(#exe_date#, 'yyyy-mm-dd')
	                   and ROUTE.route_class is not null
	                   and ROUTE.VALID_FLAG = '0'
	                 order by ROUTE.ROUTE_ID) t
	         ) t where t.route_id = #route_id#
	         ) t
	 where t.rowlength = 1
	</select>
	<select id="getlinecountInfobyvinForChart" parameterClass="map" resultClass="Integer">
        select count(1) from (
          SELECT distinct TO_CHAR(ROUTE.ROUTE_ID) ROUTE_ID,ROUTE.route_name
          FROM CLW_XC_ROUTE_T ROUTE,TQC_TRIP_EXECUTE exe
         WHERE exe.vehicle_vin = #vin# AND
            route.route_id = exe.route_id and
            exe.exe_date = to_date(#exe_date#,'yyyy-mm-dd') and
            ROUTE.VALID_FLAG = '0'
         )
	</select>
	<select id="getcarInfobyentForChart" parameterClass="Map" resultMap="chart_car_info">
		select exe.trip_id,exe.status,exe.route_id,exe.type,exe.update_time, info.vehicle_ln ,exe.vehicle_vin,nvl(info.vehicle_code,'未知') vehicle_code,
    	exe.send_condition,exe.send_time,exe.send_order,week_seq,add_flag,exe.valid_days,car_tem.iconSkin car_state,to_char(exe.end_time,'yyyy-mm-dd') end_time,to_char(exe.start_time,'yyyy-mm-dd') start_time,
    	info.limite_number,decode(exe.update_time,null,'',1) mesg_flag,info.vehicle_type,
    	(select cydt.driver_name from clw_yw_driver_t cydt where cydt.driver_id=exe.driver_id group by cydt.driver_name) as driver_name,
    	exe.driver_id,exe.valid_flag,exe.crc,exe.trip_group,exe.exe_date,car_tem.driver_id as updriver_id
		from TQC_TRIP_EXECUTE exe,CLW_CL_BASE_INFO_T info,
           (select CASE WHEN CAR_T.ONLINE_FLAG = '1' THEN 'online' ELSE 'offline' END AS iconSkin,
	      CASE WHEN CAR_T.ONDVR_FLAG = '1' THEN 'ondvr' ELSE 'offdvr' END AS dvrState,
	         car_t.vehicle_vin,car_t.driver_id
		  from (
		       select CASE WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '0' AND (SYSDATE - JT.TERMINAL_TIME) * 24 * 60 * 60 &gt;= 30 * 60 THEN '0'
		              WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '1' AND (SYSDATE - JT.TERMINAL_TIME) * 24 * 60 * 60 &gt;= 5 * 60 THEN '0'
		              WHEN JT.TERMINAL_TIME is null THEN '0' ELSE '1' END ONLINE_FLAG,
		         CASE WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '0' AND (SYSDATE - JT.TERMINAL_TIME) * 24 * 60 * 60 &gt;= 30 * 60 THEN '0'
		              WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '1' AND (SYSDATE - JT.TERMINAL_TIME) * 24 * 60 * 60 &gt;= 5 * 60 THEN '0'
		              WHEN JT.TERMINAL_TIME is null THEN '0' WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '0' THEN '0'
		              WHEN NVL(SUBSTRB(JT.VEH_EXT_INFO, 1, 1), '1') = '0' THEN '0' ELSE '1' END ONDVR_FLAG,
		        jt.vehicle_vin,jt.route_id driver_id
		    from CLW_JC_TERMINAL_T JT
		  ) CAR_T ) car_tem		  
		where exe.route_id = #route_id#
		and car_tem.vehicle_vin = exe.vehicle_vin
		and info.valid_flag = '0'
		and exe.vehicle_vin = info.vehicle_vin
		and exe.exe_date = to_date(#exe_date#,'yyyy-mm-dd')
		order by exe.send_order
	</select>
	<select id="getcarInfobyroute_idForChart" parameterClass="Map" resultMap="chart_car_info">
		select exe.trip_id,exe.status,exe.route_id,exe.type,exe.update_time, info.vehicle_ln ,exe.vehicle_vin,nvl(info.vehicle_code,'未知') vehicle_code,
    	exe.send_condition,exe.send_time,exe.send_order,week_seq,add_flag,exe.valid_days,car_tem.iconSkin car_state,to_char(exe.end_time,'yyyy-mm-dd') end_time,to_char(exe.start_time,'yyyy-mm-dd') start_time,
    	info.limite_number,decode(exe.update_time,null,'',1) mesg_flag,info.vehicle_type,
    	(select cydt.driver_name from clw_yw_driver_t cydt where cydt.driver_id=exe.driver_id group by cydt.driver_name) as driver_name,
    	exe.driver_id,exe.valid_flag,exe.crc,exe.trip_group,exe.exe_date,car_tem.driver_id as updriver_id
		from TQC_TRIP_EXECUTE exe,CLW_CL_BASE_INFO_T info,
           (select CASE WHEN CAR_T.ONLINE_FLAG = '1' THEN 'online' ELSE 'offline' END AS iconSkin,
	      CASE WHEN CAR_T.ONDVR_FLAG = '1' THEN 'ondvr' ELSE 'offdvr' END AS dvrState,
	         car_t.vehicle_vin,car_t.driver_id
		  from (
		       select CASE WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '0' AND (SYSDATE - JT.TERMINAL_TIME) * 24 * 60 * 60 &gt;= 30 * 60 THEN '0'
		              WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '1' AND (SYSDATE - JT.TERMINAL_TIME) * 24 * 60 * 60 &gt;= 5 * 60 THEN '0'
		              WHEN JT.TERMINAL_TIME is null THEN '0' ELSE '1' END ONLINE_FLAG,
		         CASE WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '0' AND (SYSDATE - JT.TERMINAL_TIME) * 24 * 60 * 60 &gt;= 30 * 60 THEN '0'
		              WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '1' AND (SYSDATE - JT.TERMINAL_TIME) * 24 * 60 * 60 &gt;= 5 * 60 THEN '0'
		              WHEN JT.TERMINAL_TIME is null THEN '0' WHEN NVL(SUBSTRB(JT.STAT_INFO, 32, 1), '1') = '0' THEN '0'
		              WHEN NVL(SUBSTRB(JT.VEH_EXT_INFO, 1, 1), '1') = '0' THEN '0' ELSE '1' END ONDVR_FLAG,
		        jt.vehicle_vin,jt.route_id driver_id
		    from CLW_JC_TERMINAL_T JT
		  ) CAR_T ) car_tem
		where exe.route_id = #route_id#
		<!-- and exe.vehicle_vin = #vehicle_vin# --> 
		and info.valid_flag = '0'
		and exe.vehicle_vin = info.vehicle_vin
		and car_tem.vehicle_vin = exe.vehicle_vin
		and exe.exe_date = to_date(#exe_date#,'yyyy-mm-dd')
		order by exe.send_order
	</select>
	<procedure id="add_route_car_" parameterMap="pm_add_route_car_">
		{call CBM_MODULE_PACK.dispatch_add_car_changeno(?, ? ,? ,? ,?, ?, ?, ?, ?, ?, ?, ?, ?)}
    </procedure>
    
    <procedure id="tqc_trip_exe_back_" parameterMap="pm_tqc_trip_exe_back_">
		{call TQC_TRIP_EXE_BACK(?,to_date(?,'yyyy-mm-dd'))}
    </procedure>
    <procedure id="tqc_trip_exe_totemp_" parameterMap="pm_tqc_trip_exe_totemp_">
		{call TQC_TRIP_EXE_TOTEMP(?,to_date(?,'yyyy-mm-dd'))}
    </procedure>
    <procedure id="add_route_line_" parameterMap="pm_add_route_line_">
		{call CBM_MODULE_PACK.dispatch_add_line_changeno(?, ? ,? ,? ,?, ?, ?, ?, ?, ?, ?, ?)}
    </procedure>
    <procedure id="del_route_car_" parameterMap="pm_del_route_car_">
		{call CBM_MODULE_PACK.dispatch_del_car_changeno(?, ? ,?,?,?,?,?)}
    </procedure>
    <procedure id="del_route_bygroup_" parameterMap="pm_del_route_bygroup_">
		{call CBM_MODULE_PACK.dispatch_del_car_bygroup(?, ? ,? ,? ,?,?,?)}
    </procedure>
    <procedure id="updateold_route_car_" parameterMap="pm_updateold_route_car_">
		{call TQC_TRIP_FRONT(to_date(?,'yyyy-mm-dd'), ?, ? ,?)}
    </procedure>
	<select id="getInfoForChart" parameterClass="chart" resultMap="chart_info">
	SELECT A1.ROUTE_ID,A1.route_name, A1.SITE_ID, A1.SITE_NAME, A1.RS_ORDER, A1.SITE_UPDOWN, A1.RE_FLAG,
		   A1.VEHICLE_VIN, A1.INOUT_FLAG, A1.CAR_STATE, A1.VEHICLE_LN,
		   A1.UPNUM, A1.DOWNNUM, A1.STU_ERROR, A1.TIME_ERROR
	FROM 
	(
		(
			SELECT T2.ROUTE_ID,route.route_name,T2.SITE_ID, T3.SITE_NAME, T2.RS_ORDER, T2.SITE_UPDOWN,
				   '' VEHICLE_VIN, '0' INOUT_FLAG, '' CAR_STATE, '0' RE_FLAG, '' VEHICLE_LN,
				   0 UPNUM, 0 DOWNNUM,
				   NVL(T1.alarm_yanc,-1) STU_ERROR,
				   NVL(T1.alarm_tiq,-1) TIME_ERROR
			FROM CLW_XC_ROUTESITE_T T2,CLW_XC_SITE_T T3,clw_xc_route_t route,
			     (
				   select t.route_id,
                        alarm_yanc,
                        alarm_tiq
                   from (select t.route_id,
                            decode(t.alarm_type, 5, 1) alarm_yanc,
                            decode(t.alarm_type, 2, 1) alarm_tiq,
                            t.alarm_date
                       from TQC_ALARM_RECORDS t
                      where trunc(t.alarm_date, 'dd') =
                            trunc(sysdate, 'dd')
                        and t.VEHICLE_VIN = #VIN#
                        and t.alarm_type in (5, 2)
                        and t.route_id = #route_id#
                      order by t.alarm_date desc) t
                  where rownum = 1
			     ) T1
			WHERE T2.SITE_ID = T3.SITE_ID
			and route.route_id = t2.route_id
			AND T2.ROUTE_ID = T1.ROUTE_ID(+)
			<!-- AND T2.SITE_ID = T1.SITE_ID(+) -->
			AND T3.VALID_FLAG = '0'
			<dynamic>
			    <!--  
				<isNotEmpty prepend="AND" property="vehicle_ln">
					T2.ROUTE_ID IN 
						(
							SELECT A.ROUTE_ID FROM CLW_CL_BASE_INFO_T A
							WHERE A.VALID_FLAG = '0'
							<isNotEmpty prepend="AND" property="vehicle_ln">
								upper(A.VEHICLE_LN) like '%' || upper(#vehicle_ln#) ||'%' escape '\'
							</isNotEmpty>
						)
				</isNotEmpty>
				-->
				<isNotEmpty prepend="AND" property="route_id">
					T2.ROUTE_ID=#route_id#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="site_updown">
					T2.SITE_UPDOWN=#site_updown#
				</isNotEmpty>
			</dynamic>
		)
		UNION ALL
		(
			SELECT T1.ROUTE_ID,route.route_name, T1.SITE_ID, '' SITE_NAME, T2.RS_ORDER, T2.SITE_UPDOWN,
				   T1.VEHICLE_VIN, T1.INSTANCE_PERCENT INOUT_FLAG, '' CAR_STATE, '1' RE_FLAG, T3.VEHICLE_LN,
				   0 UPNUM, 0 DOWNNUM,0 STU_ERROR, 0 TIME_ERROR
			FROM CLW_JC_TERMINAL_T T1,CLW_XC_ROUTESITE_T T2,CLW_CL_BASE_INFO_T T3,clw_xc_route_t route
			WHERE T1.ROUTE_ID = T2.ROUTE_ID
			and route.route_id = t2.route_id
			AND T1.SITE_ID = T2.SITE_ID
			AND T1.VEHICLE_VIN = T3.VEHICLE_VIN
			<isNotEmpty prepend="AND" property="site_updown">
				T2.SITE_UPDOWN=#site_updown#
			</isNotEmpty>
			AND T3.VALID_FLAG = '0'
			AND T3.DEVICE_TYPE = '0'
			AND T1.DEVICE_TYPE = '0'
			AND T1.TERMINAL_TIME BETWEEN TRUNC(to_date(#exe_date#,'yyyy-mm-dd'),'dd') AND TRUNC(to_date(#exe_date#,'yyyy-mm-dd'),'dd')+1			
			<dynamic>
				<isNotEmpty prepend="AND" property="vehicle_ln">
					upper(T3.VEHICLE_LN) like '%' || upper(#vehicle_ln#) ||'%' escape '\'
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="VIN">
					T1.VEHICLE_VIN = #VIN#
				</isNotEmpty>				
				<isNotEmpty prepend="AND" property="route_id">
					T3.ORGANIZATION_ID IN
							<![CDATA[
								(SELECT ENTERPRISE_ID
								     FROM CLW_JC_ENTERPRISE_VI
								     WHERE LEFT_NUM >= (SELECT LEFT_NUM
								                  FROM CLW_JC_ENTERPRISE_VI
								                  WHERE ENTERPRISE_ID = #user_organization_id#)
								     AND RIGHT_NUM <=(SELECT RIGHT_NUM
								                  FROM CLW_JC_ENTERPRISE_VI
								                  WHERE ENTERPRISE_ID =#user_organization_id#)        
								)
						     ]]>
					 <!-- AND T3.ROUTE_ID = #route_id# -->
					 AND T1.ROUTE_ID = #route_id#
				</isNotEmpty>									
			</dynamic>		
		)
	) A1
	ORDER BY A1.SITE_UPDOWN,A1.RS_ORDER,A1.RE_FLAG,A1.INOUT_FLAG ASC
	</select>
	<select id="getdelvehicleinExe" parameterClass="map" resultMap="delvehicleinExemap">
	select t.trip_id,t.update_time,t.vehicle_vin,t.exe_date
	from TQC_TRIP_EXECUTE t
		where t.vehicle_vin = #vehicle_vin#
		and t.exe_date = trunc(sysdate, 'dd')
		and t.send_order = #send_order#
		and t.trip_id = #trip_id#
	</select>
	<select id="getCountStuListBySite" parameterClass="chart" resultClass="Integer">
		SELECT COUNT(1)
		FROM CLW_XC_ST_CHECK_RECORD_T T1,CLW_XC_STUDENT_T T2
		WHERE T1.STU_ID = T2.STU_ID
		AND T2.VALID_FLAG = '0'
		<isNotEmpty prepend="AND" property="site_id">
			T1.SITE_ID=#site_id#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="route_id">
			T1.ROUTE_ID=#route_id#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="VIN">
			T1.VEHICLE_VIN=#VIN#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="VSS_FLAG">
			 T1.VSS_FLAG = #VSS_FLAG#
		</isNotEmpty>	
		<isNotEmpty prepend="AND" property="alarm_type_id">
			 T1.ALARM_TYPE_ID = #alarm_type_id#
		</isNotEmpty>	
	    <isNotEmpty prepend="AND" property="begTime">
	        T1.TERMINAL_TIME &gt;= TO_DATE(#begTime#,'YYYY-MM-DD HH24:mi:ss') 
		</isNotEmpty>
	    <isNotEmpty prepend="AND" property="endTime"> 
	        T1.TERMINAL_TIME &lt;= TO_DATE(#endTime#,'YYYY-MM-DD HH24:mi:ss')
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="id">
			T1.INOUT_ID = #id#
		</isNotEmpty>
	</select>
	
	<select id="getStuListBySite" parameterClass="chart" resultMap="stu">
	SELECT T2.STU_NAME, T2.STU_CODE, T2.STU_SCHOOL, T2.STU_CLASS,
		   T2.TEACHER_TEL,T2.RELATIVE_TEL,
		   CASE 
		   WHEN T1.VSS_FLAG='0' AND T1.ALARM_TYPE_ID IS NULL THEN '正常上车'
		   WHEN T1.VSS_FLAG='0' AND T1.ALARM_TYPE_ID = '73' THEN '未在规定站点上车'
		   WHEN T1.VSS_FLAG='1' AND T1.ALARM_TYPE_ID IS NULL THEN '正常下车'
		   WHEN T1.VSS_FLAG='1' AND T1.ALARM_TYPE_ID = '74' THEN '未在规定站点下车'
		   WHEN T1.VSS_FLAG='2' AND T1.ALARM_TYPE_ID = '79' THEN '未上车'
		   WHEN T1.VSS_FLAG='2' AND T1.ALARM_TYPE_ID = '80' THEN '未下车'
		   WHEN T1.VSS_FLAG='2' AND T1.ALARM_TYPE_ID = 'QJ' THEN '请假'
		   ELSE '--' END VSS_FLAG
	FROM CLW_XC_ST_CHECK_RECORD_T T1,CLW_XC_STUDENT_T T2
	WHERE T1.STU_ID = T2.STU_ID
	AND T2.VALID_FLAG = '0'
	<isNotEmpty prepend="AND" property="site_id">
		T1.SITE_ID=#site_id#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="route_id">
		T1.ROUTE_ID=#route_id#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="VIN">
		T1.VEHICLE_VIN=#VIN#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="VSS_FLAG">
		 T1.VSS_FLAG = #VSS_FLAG#
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="alarm_type_id">
		 T1.ALARM_TYPE_ID = #alarm_type_id#
	</isNotEmpty>	
    <isNotEmpty prepend="AND" property="begTime">
        T1.TERMINAL_TIME &gt;= TO_DATE(#begTime#,'YYYY-MM-DD HH24:mi:ss') 
	</isNotEmpty>
    <isNotEmpty prepend="AND" property="endTime"> 
        T1.TERMINAL_TIME &lt;= TO_DATE(#endTime#,'YYYY-MM-DD HH24:mi:ss')
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="id">
		T1.INOUT_ID = #id#
	</isNotEmpty>	
    <dynamic prepend="ORDER BY">  
		<isNotEmpty property="sortname">  
		    $sortname$   $sortorder$  
		</isNotEmpty>  
	</dynamic>
	</select>
	
	<select id="getVehByRouteid" parameterClass="chart" resultMap="car_select">
		SELECT DISTINCT T1.VEHICLE_VIN,T2.VEHICLE_LN 
		FROM CLW_XC_TRIP_T T1,CLW_CL_BASE_INFO_T T2
		WHERE T1.VEHICLE_VIN = T2.VEHICLE_VIN
		AND T1.VALID_FLAG='0'
		AND T2.VALID_FLAG = '0'
		AND T2.DEVICE_TYPE = '0'
		<isNotEmpty prepend="AND" property="user_organization_id">
			T2.ORGANIZATION_ID IN
			<![CDATA[
		    		(SELECT ENTERPRISE_ID
					     FROM CLW_JC_ENTERPRISE_VI
					     WHERE LEFT_NUM >= (SELECT LEFT_NUM
					                  FROM CLW_JC_ENTERPRISE_VI
					                  WHERE ENTERPRISE_ID = #user_organization_id#)
					     AND RIGHT_NUM <=(SELECT RIGHT_NUM
					                  FROM CLW_JC_ENTERPRISE_VI
					                  WHERE ENTERPRISE_ID =#user_organization_id#)        
					)
			]]>
		</isNotEmpty>		
		<isNotEmpty prepend="AND" property="route_id">
			T1.ROUTE_ID=#route_id#
		</isNotEmpty>
	</select>
	<insert id="insertdispatchcarInfo" parameterClass="chart">
		INSERT INTO TQC_TRIP_EXECUTE
		  (trip_id, vehicle_vin, route_id, type, send_condition, send_time ,
		  send_order, week_seq, update_time, valid_flag, exe_date,add_flag,remain_times,start_time,end_time)
		VALUES
		  (TQC_EXECUTE_ID.NEXTVAL, #VIN#, #route_id#, 0, #send_condition#, #send_time#,
		  #send_order#, #week_seq#, sysdate, 0, to_date(#exe_date#,'yyyy-mm-dd'),#add_flag#,#valid_days#,to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd'),to_date(to_char(sysdate,'yyyy-mm-dd'),'yyyy-mm-dd'))
	</insert>
	<procedure id="make_route_car_t" parameterMap="pm_make_route_car_t">
		{call TQC_LOOP_EVERY(to_date(?,'yyyy-mm-dd'))}
    </procedure>
    <update id="routecarnouse_temp" parameterClass="map">
    	update TQC_TRIP_EXECUTE set VALID_FLAG = '1' where route_id = #route_id# 
    	and vehicle_vin = #vehicle_vin#
    	and exe_date >= to_date(#exe_date#,'yyyy-mm-dd')
    	and trip_group = #trip_group#
    </update>
    <!-- 删除做临时数据 不应该和历史数据相重复-->
    <update id="routecarnouse" parameterClass="String">
    	update TQC_TRIP_EXECUTE set VALID_FLAG = '1' where trip_id = #value#
    	and exe_date >= trunc(sysdate,'dd')
    </update>
    <!-- 查询下发行程数据 有可能是今天明天 不应该和历史数据相重复-->
    <select id="getdelroutecar" parameterClass="String" resultMap="chart_car_info">
    	select trip_id,'' status,route_id,type,update_time, '' vehicle_ln ,vehicle_vin,'' vehicle_code,
    	send_condition,send_time,send_order,week_seq,add_flag,valid_days,'' car_state,to_char(end_time,'yyyy-mm-dd') end_time,to_char(start_time,'yyyy-mm-dd') start_time,
    	'' limite_number,decode(update_time,null,'',1) mesg_flag,'' vehicle_type,
    	'' driver_name,
    	driver_id,valid_flag,crc,trip_group,exe_date,'' as updriver_id from TQC_TRIP_EXECUTE where trip_id = #value#
    	and exe_date>=trunc(sysdate,'dd')
    </select>
    <select id="getdelroutecarlist" parameterClass="map" resultMap="chart_car_info">
    	select trip_id,'' status,route_id,type,update_time, '' vehicle_ln ,vehicle_vin,'' vehicle_code,
    	send_condition,send_time,send_order,week_seq,add_flag,valid_days,'' car_state,to_char(end_time,'yyyy-mm-dd') end_time,to_char(start_time,'yyyy-mm-dd') start_time,
    	'' limite_number,decode(update_time,null,'',1) mesg_flag,'' vehicle_type,
    	'' driver_name,
    	driver_id,valid_flag,crc,trip_group,to_char(exe_date,'yyyy-mm-dd') exe_date,'' as updriver_id from TQC_TRIP_EXECUTE where route_id = #route_id#
    	and exe_date >= to_date(#exe_date#,'yyyy-mm-dd')
    	and valid_flag = '1'
    	<!-- and add_flag = '1' -->
    </select>
    <update id="tqc_trip_exe_update_crc_today" parameterClass="map">
    	update TQC_TRIP_EXECUTE t set t.crc = '1' where route_id = #route_id#
    	and t.exe_date > to_date(#exe_date#,'yyyy-mm-dd')
    </update>
    <update id="tqc_trip_exe_update_crc_ntoday" parameterClass="map">
    	update TQC_TRIP_EXECUTE t set t.crc = '1' where route_id = #route_id#
    	and t.exe_date >= to_date(#exe_date#,'yyyy-mm-dd')
    </update>
</sqlMap>