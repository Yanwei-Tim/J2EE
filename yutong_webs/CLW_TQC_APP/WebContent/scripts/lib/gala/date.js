Gala.Date=new Class({options:{beginYear:1990,endYear:2010,lang:"zh_CN",dateFormatStyle:"yyyy-MM-dd hh:mm:ss",calendarPanel:null,interval:null,delay:500,hideSelectStyle:"gala_date_select_hide",colors:{"cur_word":"#FFFFFF","cur_bg":"#00FF00","sun_word":"#FF0000","sat_word":"#0000FF","td_word_light":"#333333","td_word_dark":"#CCCCCC","td_bg_out":"#EFEFEF","td_bg_over":"#FFCC00","tr_word":"#FFFFFF","tr_bg":"#666666","input_border":"#CCCCCC","input_bg":"#EFEFEF"}},initialize:function(_,B){this.setOptions(B);this.dateControl=null;var A=$(_);if($defined(A))this.dateControl=A;if(!$defined(this.dateControl)){throw new Error("arguments[0] is necessary!");return}this.eleId=_;this.dateControl.onclick=this.show.bind(this);this.active=false;if(this.options.initialize)this.options.initialize.call(this)},show:function(){if(this.showed)return;var $=this.dateControl.getCoordinates();this.options.calendarPanel=new Element("div",{"id":"gala_date_calendarPanel_"+this.eleId,"styles":{"position":"absolute","z-index":"99999","background-color":"#FFFFFF","border":"1px solid #CCCCCC","width":"175px","font-size":"12px","top":$.top+$.height,"left":$.left}});this.showed=true;var _=this.dateControl.getValue();this.date=($defined(_)&&_!="")?_.strToDate():new Date();this.year=this.date.getFullYear();this.month=this.date.getMonth();this.day=this.date.getDate();this.hour=this.date.getHours();this.minute=this.date.getMinutes();var A=this.date.getTime()%60000;this.second=(A-(A%1000))/1000;this.options.calendarPanel.injectInside($E("body"));if(window.ie6)$$("select").addClass(this.options.hideSelectStyle);this.draw();this.addEvent();this.bindData()},draw:function(){var K=new Element("form",{"id":"gala_date_calendar_form_"+this.eleId,"name":"gala_date_calendar_form_"+this.eleId}).injectInside(this.options.calendarPanel),N=new Element("table",{"width":"100%","border":"0","cellpadding":"0","cellspacing":"1"}).injectInside(K),G=new Element("tbody").injectInside(N),M=new Element("tr").injectInside(G),J=new Element("th",{"align":"left","width":"1%"}).injectInside(M),E=new Element("th",{"align":"center","width":"98%","styles":{"white-space":"nowrap"}}).injectInside(M),C=new Element("th",{"align":"left","width":"1%"}).injectInside(M),R=new Element("select",{"id":"gala_date_calendar_year_"+this.eleId,"font-size":"12px"}).injectInside(E),P=new Element("select",{"id":"gala_date_calendar_month_"+this.eleId,"font-size":"12px"}).injectInside(E),W=new Element("input",{"styles":{"border":"1px solid "+this.options.colors["input_border"],"background-color":this.options.colors["input_bg"],"width":"16px","height":"20px"},"name":"prevMonth","id":"gala_date_prev_month_"+this.eleId,"value":"<","type":"button"}).injectInside(J),S=new Element("input",{"styles":{"border":"1px solid "+this.options.colors["input_border"],"background-color":this.options.colors["input_bg"],"width":"16px","height":"20px"},"name":"nextMonth","id":"gala_date_next_month_"+this.eleId,"value":">","type":"button"}).injectInside(C),V=new Element("table",{"id":"gala_date_calendar_table_"+this.eleId,"styles":{"width":"100%","border":"0px solid #CCCCCC","background-color":"#FFFFFF"},"cellpadding":"3","cellspacing":"1"}).injectInside(K),X=new Element("tbody",{"id":"gala_date_calendar_table_tbody_"+this.eleId}).injectInside(V),F=new Element("table",{"styles":{"width":"100%","border":"0px solid #CCCCCC","background-color":"#FFFFFF"},"cellpadding":"3","cellspacing":"1"}).injectInside(K),L=new Element("tbody").injectInside(F),D=new Element("tr",{"styles":{"background-color":this.options.colors["input_bg"]}}).injectInside(L),$=new Element("td",{"align":"center"}).injectInside(D),H=new Element("input",{"id":"gala_date_calendar_time_hour_"+this.eleId,"type":"text","name":"calendarTimeHour","value":this.hour<10?"0"+this.hour:this.hour,"readonly":true,"size":"2","styles":{"white-space":"nowrap"}}).injectInside($);$.appendText(" : ");var B=new Element("input",{"id":"gala_date_calendar_time_minute_"+this.eleId,"type":"text","name":"calendarTimeHour","value":this.minute<10?"0"+this.minute:this.minute,"readonly":true,"size":"2","styles":{"white-space":"nowrap"}}).injectInside($);$.appendText(" : ");var _=new Element("input",{"id":"gala_date_calendar_time_second_"+this.eleId,"type":"text","name":"calendarTimeHour","value":this.second<10?"0"+this.second:this.second,"readonly":true,"size":"2","styles":{"white-space":"nowrap"}}).injectInside($),I=new Element("table",{"styles":{"width":"100%","border":"0px solid #CCCCCC","background-color":"#FFFFFF"},"cellpadding":"3","cellspacing":"1"}).injectInside(K),O=new Element("tbody").injectInside(I),T=new Element("tr",{"styles":{"background-color":this.options.colors["input_bg"]}}).injectInside(O),U=new Element("td").injectInside(T),Q=new Element("td").injectInside(T),A=new Element("td").injectInside(T);new Element("input",{"id":"gala_date_calendar_clear_"+this.eleId,"name":"calendarClear","type":"button","value":Gala.Date.Language[this.options.lang]["clear"],"styles":{"border":"1px solid "+this.options.colors["input_border"],"background-color":this.options.colors["input_bg"],"width":"100%","height":"20px","font-size":"12px"}}).injectInside(U);new Element("input",{"id":"gala_date_calendar_today_"+this.eleId,"name":"calendarToday","type":"button","value":Gala.Date.Language[this.options.lang]["today"],"styles":{"border":"1px solid "+this.options.colors["input_border"],"background-color":this.options.colors["input_bg"],"width":"100%","height":"20px","font-size":"12px"}}).injectInside(Q);new Element("input",{"id":"gala_date_calendar_close_"+this.eleId,"name":"calendarClose","type":"button","value":Gala.Date.Language[this.options.lang]["close"],"styles":{"border":"1px solid "+this.options.colors["input_border"],"background-color":this.options.colors["input_bg"],"width":"100%","height":"20px","font-size":"12px"}}).injectInside(A)},addEvent:function(){$("gala_date_calendar_year_"+this.eleId).addEvent("change",this.changeYear.bind(this));$("gala_date_calendar_month_"+this.eleId).addEvent("change",this.changeMonth.bind(this));$("gala_date_prev_month_"+this.eleId).addEvent("click",this.goPrevMonth.bind(this));$("gala_date_next_month_"+this.eleId).addEvent("click",this.goNextMonth.bind(this));$("gala_date_calendar_clear_"+this.eleId).addEvent("click",this.clear.bind(this));$("gala_date_calendar_today_"+this.eleId).addEvent("click",this.today.bind(this));$("gala_date_calendar_close_"+this.eleId).addEvent("click",this.close.bind(this));$("gala_date_calendar_time_hour_"+this.eleId).addEvent("mousewheel",this.changeHour.bind(this));$("gala_date_calendar_time_minute_"+this.eleId).addEvent("mousewheel",this.changeMinute.bind(this));$("gala_date_calendar_time_second_"+this.eleId).addEvent("mousewheel",this.changeSecond.bind(this));$("gala_date_calendar_time_hour_"+this.eleId).addEvent("click",this.changeHour.bind(this));$("gala_date_calendar_time_minute_"+this.eleId).addEvent("click",this.changeMinute.bind(this));$("gala_date_calendar_time_second_"+this.eleId).addEvent("click",this.changeSecond.bind(this));$("gala_date_calendar_year_"+this.eleId).addEvent("click",function(){this.active=true}.bind(this));$("gala_date_calendar_month_"+this.eleId).addEvent("click",function(){this.active=true}.bind(this));this.dateControl.onmouseover=this.options.calendarPanel.onmouseover=function(){$clear(this.options.interval);this.active=false}.bind(this);this.dateControl.onmouseout=this.options.calendarPanel.onmouseout=function(){if(!this.active)this.options.interval=this.close.delay(this.options.delay,this)}.bind(this);this.dateControl.onchange=function(){this.active=false}.bind(this)},bindData:function(){this.bindYear();this.bindMonth();this.bindDayData()},bindDayData:function(){var A=new Date(this.year,this.month,1).getDay();A=1-A;var _=new Date(this.year,this.month+1,0).getDate(),E=$("gala_date_calendar_table_tbody_"+this.eleId);if(E.getChildren().length>0){E.remove();E=new Element("tbody",{"id":"gala_date_calendar_table_tbody_"+this.eleId}).injectInside($("gala_date_calendar_table_"+this.eleId))}var C=new Element("tr").injectInside(E);for(var I=0;I<7;I++){var H=new Element("th",{"styles":{"font-weight":"normal","background-color":this.options.colors["tr_bg"],"color":this.options.colors["tr_word"]}});H.appendText(Gala.Date.Language[this.options.lang]["weeks"][I]);H.injectInside(C)}var F=this.day,B=0;while(A<=_){var G=new Element("tr");for(I=0;I<7;I++){if(A<=_&&A>0){B=new Date(this.year,this.month,A).getDay();var D=new Element("td",{"align":"center","styles":{"color":(B==0||B==6)?this.options.colors["td_word_dark"]:this.options.colors["td_word_light"],"background-color":(A==F)?this.options.colors["cur_bg"]:this.options.colors["td_bg_out"],"cursor":"pointer"}}).appendText(A).injectInside(G);this.setCalDayCellEvent(D,F)}else D=new Element("td").appendText(" ").injectInside(G);A++}G.injectInside(E)}},bindYear:function(){var _=$("gala_date_calendar_year_"+this.eleId);_.empty();for(var B=this.options.beginYear;B<=this.options.endYear;B++){var A=new Element("option",{"value":B,"selected":(B==this.year?true:false)});A.setHTML(B+Gala.Date.Language[this.options.lang]["year"]);A.inject(_)}},bindMonth:function(){var _=$("gala_date_calendar_month_"+this.eleId);_.empty();for(var B=0;B<12;B++){var A=new Element("option",{"value":B,"selected":(B==this.month?true:false)});A.setHTML(Gala.Date.Language[this.options.lang]["months"][B]);A.inject(_)}},setCalDayCellEvent:function($,_){$.addEvent("mouseover",function(){$.setStyle("background-color",this.options.colors["td_bg_over"])}.bind(this));$.addEvent("mouseout",function(){$.setStyle("background-color",($.getText().toInt()==_?this.options.colors["cur_bg"]:this.options.colors["td_bg_out"]))}.bind(this));$.addEvent("click",function(){this.day=$.getText();this.refreshDate();this.close()}.bind(this))},changeYearOrMonth:function(){var C=$("gala_date_calendar_year_"+this.eleId);for(var B=0,_=C.length;B<_;B++)if(C[B].value==this.date.getFullYear()){C[B].selected=true;break}var A=$("gala_date_calendar_month_"+this.eleId);for(B=0,_=A.length;B<_;B++)if(A[B].value==this.date.getMonth()){A[B].selected=true;break}},changeYear:function(){this.year=$("gala_date_calendar_year_"+this.eleId).value;this.refreshYearAndMonth()},changeMonth:function(){this.month=$("gala_date_calendar_month_"+this.eleId).value;this.refreshYearAndMonth()},changeHour:function(){var _=$("gala_date_calendar_time_hour_"+this.eleId),A=_.value.toInt();if(A>=23)this.hour=_.value="00";else this.hour=_.value=(A+1)<10?"0"+(A+1):A+1;this.refreshDate()},changeMinute:function(){var _=$("gala_date_calendar_time_minute_"+this.eleId),A=_.value.toInt();if(A>=59)this.minute=_.value="00";else this.minute=_.value=(A+1)<10?"0"+(A+1):A+1;this.refreshDate()},changeSecond:function(){var _=$("gala_date_calendar_time_second_"+this.eleId),A=_.value.toInt();if(A>=59)this.second=_.value="00";else this.second=_.value=(A+1)<10?"0"+(A+1):A+1;this.refreshDate()},refreshYearAndMonth:function(){this.date=new Date(this.year,this.month,1);this.changeYearOrMonth();this.bindDayData()},refreshDate:function(){this.dateControl.setProperty("value",new Date(this.year,this.month,this.day,this.hour,this.minute,this.second).format(this.options.dateFormatStyle))},goPrevMonth:function(){if(this.year==this.options.beginYear&&this.month==0)return;this.month--;if(this.month==-1){this.year--;this.month=11}this.refreshYearAndMonth()},goNextMonth:function(){if(this.year==this.options.endYear&&this.month==11)return;this.month++;if(this.month==12){this.year++;this.month=0}this.refreshYearAndMonth()},getDayData:function(D,A){var C=[],$=new Date(this.year,this.month,1),_=new Date(D,A,1).getDay(),B=new Date(D,A+1,0).getDate();alert(_+"--"+B)},clear:function(){this.dateControl.value=""},today:function(){this.dateControl.setProperty("value",new Date().format(this.options.dateFormatStyle));this.close()},close:function(){this.showed=false;this.active=false;$clear(this.interval);this.options.calendarPanel.remove();$$("select."+this.options.hideSelectStyle).removeClass(this.options.hideSelectStyle)}});Gala.Date.implement(new Options);Gala.Date.Language={"zh_CN":{"year":"\u5e74","months":["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],"weeks":["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],"clear":"\u6e05\u7a7a","today":"\u4eca\u5929","close":"\u5173\u95ed"},"en":{"year":"Year","months":["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],"weeks":["SUN","MON","TUR","WED","THU","FRI","SAT"],"clear":"CLS","today":"today","close":"close"}};Date.prototype.format=function($){var _={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"w+":"\u5929\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".charAt(this.getDay()),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test($))$=$.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var A in _)if(new RegExp("("+A+")").test($))$=$.replace(RegExp.$1,RegExp.$1.length==1?_[A]:("00"+_[A]).substr((""+_[A]).length));return $};String.prototype.strToDate=function(_){if(_==null)_="yyyy-MM-dd hh:mm:ss";var B={"y+":"y","M+":"M","d+":"d","h+":"h","m+":"m","s+":"s"},$={"y":"","M":"","d":"","h":"00","m":"00","s":"00"},A=_;for(var C in B)if(new RegExp("("+C+")").test(_))$[B[C]]=this.substring(A.indexOf(RegExp.$1),A.indexOf(RegExp.$1)+RegExp.$1.length);return new Date($["y"],$["M"]-1,$["d"],$["h"],$["m"],$["s"])};String.prototype.toDate=function(I,C){if(I==null)I="-";if(C==null)C="ymd";var _=new Array();_[0]=this;if(this.indexOf(" "))_=this.split(" ");var B=_[0].split(I),H=parseInt(B[C.indexOf("y")]);if(H.toString().length<=2)H+=2000;if(isNaN(H))H=new Date().getFullYear();var E=parseInt(B[C.indexOf("m")])-1,$=parseInt(B[C.indexOf("d")]);if(isNaN($))$=1;var G="00",F="00",D="00";if(_.length>1){var A=_[1].split(":");if(undefined!=A[0])G=parseInt(A[0],10)<10?"0"+A[0]:A[0];if(undefined!=A[1])F=parseInt(A[1],10)<10?"0"+A[1]:A[1];if(undefined!=A[2])D=parseInt(A[2],10)<10?"0"+A[2]:A[2]}return new Date(H,E,$,G,F,D)}